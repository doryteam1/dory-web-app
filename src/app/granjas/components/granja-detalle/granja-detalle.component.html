<app-notification-bar></app-notification-bar>
<app-search-bar></app-search-bar>
<app-navbar></app-navbar>
<div class="container" *ngIf="!showNotFound && !showError && !showGallery">

<div class="container__box">
<div class="header-container">
    <h3 class="header-container__title">{{granja?.nombre}}</h3>
    <img class="header-container__icon" src="assets/icons/star-filled.svg">
    <span class="header-container__rating">{{granja?.puntuacion ? (granja.puntuacion | number:'1.1-1') : 'S/C'}}</span> <span class="header-container__description">  <span class="header-container__resenas" (click)="showResenas(granja.id_granja)">({{granja?.count_resenas}} rese침as) </span> {{granja?.nombre_municipio}}, Sucre, Colombia</span>
</div>

<div class="photo-container">
    <div class="buttons-container1">
      <div>
        <img class="buttons-container__image" src="assets/icons/share.svg">
        <a class="buttons-container__description" href="#">Compartir</a>
      </div>
      <div>
        <img class="buttons-container__image" src="assets/icons/heart-filled.svg" *ngIf="granja?.favorita" (click)="changeFavorite()">
        <img class="buttons-container__image" src="assets/icons/heart-outline.svg" *ngIf="!granja?.favorita" (click)="changeFavorite()">
        <a class="buttons-container__description" href="#">Guardar</a>
      </div>
    </div>
    <div class="photo-container-padre sin-img-div"  *ngIf="fotosgranja?.length == 0">
      <img src="../../../../assets/images/sinimagen.svg" alt="">
    </div>
<div class="photo-container-padre" [ngClass]="{ 'photo-container1-div': fotosgranja?.length ==1, 'photo-container2-div': fotosgranja?.length ==2,'photo-container3-div': fotosgranja?.length ==3,'photo-container4-div': fotosgranja?.length >=4}">
  <img class="photo-container-img" id="photo-container__photo{{i+1}}" src="{{ fotogranja ? fotogranja : 'https://admin.moodyyc.com/img/no-image.png'}}"
    *ngFor="let fotogranja of fotosgranja | slice:0:4; let i =index" (click)="fotoSele(i,photosGallery)"  >
</div>

<button class="photo-container__button btn-square-blue" (click)="openGaleriaModal(photosGallery)" *ngIf="fotosgranja?.length >1 " (click)=" indice=-1">Ver todas las fotos</button>
</div>
</div>
<div class="proprietary-container">
    <div class="proprietary-container__info">
        <h3 class="proprietary-container__title">Propietario - {{granja?.propietarios[0]?.nombre_completo}} </h3>
        <span class="proprietary-container__description1">N춿 Celular  {{granja?.propietarios[0]?.celular}} </span>
        <span class="proprietary-container__description2">{{granja?.propietarios[0]?.direccion}} </span>
    </div>
    <img class="proprietary-container__image" [src]="granja?.propietarios[0]?.foto">
</div>

<div class="line">

</div>

    <div class="detail-container mt-4">
        <img class="detail-container__image" src="assets/images/layers.svg">
        <div class="detail-container__data">
            <h4 class="detail-container__title">area (M)</h4>
            <span class="detail-container__value">{{granja?.area}}</span>
        </div>
    </div>

    <div class="detail-container">
        <img class="detail-container__image" src="assets/images/fish.svg">
        <div class="detail-container__data">
            <h4 class="detail-container__title">Especies cultivadas</h4>
            <span class="detail-container__value" *ngFor="let especie of granja?.especies">{{especie.nombre}}</span>
        </div>
    </div>

    <div class="detail-container">
        <img class="detail-container__image" src="assets/images/worker.svg">
        <div class="detail-container__data">
            <h4 class="detail-container__title">Trabajadores</h4>
            <span class="detail-container__value">{{granja?.numero_trabajadores}} trabajadores en total.</span>
        </div>
    </div>

    <div class="detail-container">
        <img class="detail-container__image" src="assets/images/weigth.svg">
        <div class="detail-container__data">
            <h4 class="detail-container__title">Producci칩n estimada al mes (kg)</h4>
            <span class="detail-container__value">{{granja?.produccion_estimada_mes}} kg</span>
        </div>
    </div>

    <div class="detail-container">
        <img class="detail-container__image" src="assets/images/wave.svg">
        <div class="detail-container__data">
            <h4 class="detail-container__title">Tipo de infraestructura</h4>
            <span class="detail-container__value" *ngFor="let infraestructura of granja?.infraestructuras">{{infraestructura.nombre}}</span>
        </div>
    </div>
    
    <div class="resenas">
      <h4 class="resenas__title">Puntuaciones y rese침as</h4>
      <span class="resenas__rating">{{granja.puntuacion !== null && granja.puntuacion !== undefined ? (granja.puntuacion | number:'1.1-1') : 'Sin calificaci칩n'}}</span>
      <app-stars class="mb-4" [selectedStar]="granja?.puntuacion"></app-stars>
      <div class="card" *ngFor="let resena of resenas; let i = index">
          <div class="card__row" *ngIf="i < 3">
              <img src="{{ resena.foto_usuario ? resena.foto_usuario : 'assets/images/avatar-person.svg' }}" alt="" class="card__image">
              <div class="card__box">
                  <span class="card__title">{{resena.nombre_usuario}}</span>
                  <div class="span card__date">{{resena.fecha}}</div>
              </div>
          </div>
          <p class="card__paragh" *ngIf="i < 3">{{resena.descripcion}}</p>
          <a class="link" *ngIf="i == 2" (click)="showResenas(granja.id_granja)">Ver todas las rese침as</a>
      </div>
      <button class="resenas__button btn-rounded-blue" (click)="openQualifyModal(qualifyModal)">Calificar</button>
    </div>
</div>

<div class="search-container" *ngIf="showNotFound">
  <div class="search-container__box">
      <img class="search-container__image" src="assets/images/searching.svg">
      <h3>No se han encontrado resultados</h3>
      <p>No encontramos la granja solicitada</p>
  </div>
</div>

<div class="search-container" *ngIf="showError">
    <div class="search-container__box">
        <img class="search-container__image2" src="assets/images/problem_solving.svg">
        <h3>{{errorMessage}}</h3>
        <p>No pudimos recuperar la granja solicitada :(</p>
    </div>
</div>


<ng-template #photosGallery let-modal >
  <div class="modal-header" (click)="indice=-1" >
    <div class="box">
      <h4 class="modal-title" id="modal-basic-title">{{granja?.nombre}}</h4>
    </div>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')" ></button>
    <button type="button" *ngIf="showconte" (click)="showconte=!showconte">Ir a galeria</button>
  </div>
  <div class="modal-body"(click)="indice=-1" *ngIf="!showconte">
<div class=" photos-container-div" >
  <img src="{{ fotogranja ? fotogranja : 'https://admin.moodyyc.com/img/no-image.png'}}"
    class="photo-container-gallery"  alt="image"  *ngFor="let fotogranja of fotosgranja;let i=index"
  [ngClass]="{'box-shadow-efect':  indice==i ||  imgsele}" (click)="imgSelecionadaModal(i)">
</div>

  </div>
  <div class="modal-body"(click)="indice=-1" *ngIf="showconte">
<!-- <div class=" photos-container-div" >
  <img src="{{ fotogranja ? fotogranja : 'https://admin.moodyyc.com/img/no-image.png'}}"
    class="photo-container-gallery"  alt="image"  *ngFor="let fotogranja of fotosgranja;let i=index"
  [ngClass]="{'box-shadow-efect':  indice==i ||  imgsele}" (click)="imgSelecionadaModal()">
</div> -->
<div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="carousel">
  <div class="carousel-indicators" *ngFor="let fotogranja of fotosgranja;let ix=index">
    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to=ix class="active"
      aria-current="true" aria-label="Slide 1"></button>
    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1"
      aria-label="Slide 2"></button>
    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2"
      aria-label="Slide 3"></button>
  </div>
  <div class="carousel-inner">
    <div class="carousel-item active">
      <img src="{{ fotosgranja[imgselecmodal] ? fotosgranja[imgselecmodal] : 'https://admin.moodyyc.com/img/no-image.png'}}" class="d-block w-100"
        alt="image">
    </div>

    <div class="carousel-item carousel-contenedor-img" *ngFor="let fotogranja of fotosgranja;">
      <img src="{{ fotogranja ? fotogranja : 'https://admin.moodyyc.com/img/no-image.png'}}" class="d-block w-100"
        alt="image">
    </div>

  </div>
  <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Previous</span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Next</span>
  </button>
</div>

</div>
</ng-template>

<ng-template #qualifyModal let-c="close" let-d="dismiss">
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title" *ngIf="!success">Danos tu opinion sobre esta granja!游</h4>
    <h4 class="modal-title" id="modal-basic-title" *ngIf="success">Gracias por darnos tu opini칩n游녨</h4>
    <button type="button" class="btn-close" aria-label="Close" (click)="d('Cross click')"></button>
  </div>
  <div class="modal-body">
    <div class="qualify-modal__container" *ngIf="!success">
      <app-stars class="qualify-modal__stars" (rating)="onRating($event)"></app-stars>
      <textarea class="qualify-modal__input form-input-text-square" placeholder="Describe tu experiencia(opcional)" [(ngModel)]="descResena"></textarea>
      <button class="qualify-modal__button btn-rounded-blue" (click)="publicarResena()">
        <span *ngIf="!loading">Publicar</span>
        <div class="qualify__spinner spinner-border" role="status" *ngIf="loading">
        </div>
      </button>
    </div>
    <div class="search-container" *ngIf="success">
      <div class="search-container__box">
          <img class="search-container__image" src="assets/images/searching.svg">
          <h3>Gracias por tu opini칩n</h3>
          <p>...</p>
      </div>
  </div>
  </div>
</ng-template>
<!-- <app-granja-gallery *ngIf="showGallery" [photos]="granja?.fotos"></app-granja-gallery> -->
<app-footer></app-footer>
<app-floating-btn-auto-up></app-floating-btn-auto-up>
